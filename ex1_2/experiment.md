# 实验报告
## 问题描述
（个人身份证号） 请完成一个基于身份证号码的个人信息系统，核心功能包括以下两个。

- 一次性插入N条个人信息记录。
- 从整个信息库中根据身份证号码查询个人信息。

个人信息的数据结构如程序示例1.10所示，其中字符串id为我国居民身份证号码，长度为18个字符，包括：6个数字字符的地址码，8个数字字符的出生日期（次序为年月日），3个数字字符的顺序码（奇数分配给男性，偶数分配给女性）和1个数字字符的校验码。

个人信息系统对外提供两个功能函数，如程序示例1.11所示。其中 `person_insert()` 函数用于插入N条个人信息，内容存储在p指针指向的个人信息数据结构中； `person_search()` 用于查找字符串类型的id对应的个人信息，如果查找到，则返回对应的个人信息数据结构指针，否则返回NULL指针。

需要测量两个时间。

1. 连续插入$N$条记录所需要的时间$T$。
2. 连续进行$M$次查找所需要的时间$T$。

再由此计算出两个指标。
1. 每秒钟插入的记录数 $B = N / T$（$N$的取值分别为$10^6$、$10^7$、$10^8$、$10^9$）。
2. 每秒钟查找的记录数 $B = M / T$（$M$的取值为$10^6$）。

C++STL的map方法可以建立（key，value）的映射关系，使用key快速查找到对应的value。以map方法为核心，采用下述不同的方案实现上述两个功能函数，并评估不同方案的性能提升，从而更加深刻地理解map方法的性能特征。

实验所使用的软硬件平台参数如表1-6所示。

| CPU | Apple M1 | 架构 | Arm |
| --- | --- | --- | --- |
| 主频 | 3204/2064 MHz | 核心数 | 4+4 |
| 操作系统 | macOS 15.0 Beta版(24A5327a) | 编译器 | gcc-14 (Homebrew GCC 14.2.0) 14.2.0 |
> ▲ 表1-6 实验用软硬件平台参数

### 方案一
key为身份证号码（字符串类型），value为个人信息（person数据结构）。
### 方案二
在数量N小于$10^9$时，可以将所有的个人信息存放在一个数组中。此时，value不再存放整个数据结构的内容，而是仅存放这个数据结构在整个数组中的索引（32位无符号整数），因此value的数据容量从112个字节减小到4个字节。
### 方案三
在实现方案2的基础上，可以根据身份证号码的构成规则将含18个字符的字符串id转换为64位整数。此时，key的数据类型从字符串类型转化为64位整数。
### 方案四
在实现方案3的基础上，可以提取身份证号码的日期（共366种可能），从而形成366个映射。这样能减少映射中元素的数量，并有可能使得key缩减为32位无符号整数。

请实现上述四种方案，并按照1.4节的格式撰写完整的测试报告。

```c++
struct person {
    char id[18];        // 18位身份证号码
    char name[20];      // 姓名
    char address[60];   // 地址
    char phone_num[14]; // 电话号码
};
```
> ▲ 程序示例1.10 实验题1.2的个人信息数据结构

```c++
void person_insert(struct person *p, int N);  
struct person *person_search(const char *id); 
```
> ▲ 程序示例1.11 实验题1.2的对外函数接口

## 实验方法
实现以上四种方案，并对
## 实验结果分析
上述三方面的参数各自有三种可能性，相互组合可以得到27种不同的测试案例。这些案例中qsort()函数升序排序时间如表1-7所示。
表1-7 排序的性能评测（单位：ms）

实验结果呈现以下特点。
- 在相同数据类型和输入数据排列下，数据规模增至原来的10倍，排序时间一般随之变为11.5倍左右。
- 在相同数据规模和输入数据排列下，数据类型的区别对性能的影响不大。
- 在相同数据规模和数据类型下，输入数据排列对性能影响较大：完全随机的排序时间最长；倒序和近似顺序的时间比较接近，大约为完全随机排序时间的65%左右。
之所以产生上述现象，主要是因为以下原因。
- qsort()函数采用了快速排序方法，其计算复杂度为O（nlogn）。在n等于1M和10M时，10nlog（10n）/nlogn的值分别为11.6和11.4，这与上述第1个特点完全符合。
- qsort()函数中，数据类型仅影响其比较过程，对其控制开销和数据搬移开销影响不大，所以数据类型的差异对性能影响不大。
- qsort()函数内部可能会对不同排列类型的数据进行优化处理，使得对倒序排列和近似顺序排列的数据排序时有较高的性能。